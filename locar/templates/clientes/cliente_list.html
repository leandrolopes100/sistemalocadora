{% extends 'base.html' %}
{% load static %}

{% block title %}Clientes — Locadora{% endblock %}

{% block page_title %}
Clientes
{% endblock %}

{% block page_subtitle %}
Gerencie seus clientes, veja dados principais e acesse ações rápidas.
{% endblock %}

{% block content %}
  <!-- Barra de ações / busca -->
  <div class="flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between mb-4">
    <form method="get" class="flex items-center gap-2">
      <label for="q" class="sr-only">Buscar cliente</label>
      <input id="q" name="q" value="{{ request.GET.q|default:'' }}" type="text" placeholder="Buscar por nome, CPF, CNH..." class="w-72 max-w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-leaf-300 bg-white" />
      <button class="inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm hover:bg-leaf-50" type="submit">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-5 h-5" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 110-15 7.5 7.5 0 010 15z" />
        </svg>
        Buscar
      </button>
      {% if request.GET.q %}
        <a href="?" class="text-sm underline">Limpar</a>
      {% endif %}
    </form>

    <a href="{% url 'cliente_adicionar' %}"class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-green-700 hover:bg-green-800 text-white text-sm shadow-md transition">
      <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24">
        <path d="M12 4.5a1 1 0 011 1v5.5h5.5a1 1 0 110 2H13v5.5a1 1 0 11-2 0V13H5.5a1 1 0 110-2H11V5.5a1 1 0 011-1z"/>
      </svg>
      Cadastrar Cliente
    </a>
  </div>

  {% if clientes %}
    <!-- Tabela/Grade responsiva -->
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-leaf-50">
          <tr class="text-left text-slate-600">
            <th class="px-4 py-3 font-semibold">Cliente</th>
            <th class="px-4 py-3 font-semibold">Contato</th>
            <th class="px-4 py-3 font-semibold">CPF</th>
            <th class="px-4 py-3 font-semibold ">CNH</th>
            <th class="px-4 py-3 font-semibold">Validade CNH</th>
            <th class="px-4 py-3 font-semibold text-center ">Ações</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% for c in clientes %}
            <tr class="hover:bg-mint/60">
              <td class="px-4 py-3">
                <div class="flex items-center gap-3">
                  <div class="w-9 h-9 rounded-full bg-leaf-100 text-leaf-800 flex items-center justify-center font-semibold">
                    {{ c.nome|first|upper }}
                  </div>
                  <div class="min-w-0">
                    <div class="font-medium text-slate-800 truncate">{{ c.nome|truncatewords:2 }}</div>
                    <div class="text-xs text-slate-500">Criado em {{ c.criado_em|date:'d/m/Y' }}</div>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3">
                <div class="flex flex-col">
                  {% if c.telefone %}<span class="text-slate-700">{{ c.telefone }}</span>{% endif %}
                  {% if c.email %}<span class="text-slate-500 text-xs">{{ c.email }}</span>{% endif %}
                </div>
              </td>
              <td class="px-4 py-3">{{ c.cpf|default:'—' }}</td>
              <td class="px-4 py-3">{{ c.cnh_numero|default:'...' }}</td>
              <td class="px-4 py-3">{{ c.cnh_validade|date:'d/m/Y'|default:'...' }}</td>
              <td class="px-4 py-3 text-center">
          <div class="flex justify-center gap-2">
            <!-- Ver -->
            <a href="{% url 'cliente_detalhe' c.id %}" class="p-2 rounded-lg text-blue-600 hover:bg-blue-50 transition" title="Ver">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.065 7-9.542 7s-8.268-2.943-9.542-7z"/>
              </svg>
            </a>
            <!-- Editar -->
            <a href="{% url 'cliente_editar' c.id %}" 
              class="p-2 rounded-lg text-yellow-600 hover:bg-yellow-50 transition no-underline" 
              title="Editar">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 3.487l3.651 3.65M4.5 20.25h15m-6.75-6.75l6.75-6.75-3.651-3.65-6.75 6.75v3.65h3.651z"/>
              </svg>
            </a>  
            <!-- Deletar -->
            <a href="{% url 'cliente_excluir' c.id %}" 
               class="p-2 rounded-lg text-red-600 hover:bg-red-50 transition" title="Excluir">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </a>
          </div>
        </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Paginação -->
    {% if is_paginated %}
      <div class="mt-4 flex items-center justify-between text-sm">
        <div>
          Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
        </div>
        <div class="inline-flex rounded-xl border border-slate-200 overflow-hidden">
          {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" class="px-3 py-2 hover:bg-slate-50">Anterior</a>
          {% else %}
            <span class="px-3 py-2 text-slate-400">Anterior</span>
          {% endif %}
          {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" class="px-3 py-2 hover:bg-slate-50">Próxima</a>
          {% else %}
            <span class="px-3 py-2 text-slate-400">Próxima</span>
          {% endif %}
        </div>
      </div>
    {% endif %}

  {% else %}
    <!-- Estado vazio -->
    <div class="p-8 text-center text-slate-600">
      <div class="mx-auto w-14 h-14 rounded-2xl bg-leaf-50 flex items-center justify-center mb-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-7 h-7 text-leaf-700" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19.127a9 9 0 10-6 0M12 12a3 3 0 100-6 3 3 0 000 6z"/>
        </svg>
      </div>
      <p class="font-medium">Nenhum cliente encontrado</p>
      <p class="text-sm text-slate-500">Cadastre seu primeiro cliente para começar.</p>
      <a href="{% url 'cliente_adicionar' %}" class="mt-4 inline-flex items-center gap-2 rounded-xl bg-leaf-600 hover:bg-leaf-700 text-white px-4 py-2 text-sm shadow">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5" viewBox="0 0 24 24">
          <path d="M12 4.5a1 1 0 011 1v5.5h5.5a1 1 0 110 2H13v5.5a1 1 0 11-2 0V13H5.5a1 1 0 110-2H11V5.5a1 1 0 011-1z"/>
        </svg>
        Novo Cliente
      </a>
    </div>
  {% endif %}
{% endblock %}
